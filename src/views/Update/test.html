<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®Œç¾æ— ç¼å¹¿å‘Šæ»šåŠ¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .scroll-container {
      width: 100%;
      overflow: hidden;
      position: relative;
      padding: 2rem 0;
    }

    .scroll-track {
      display: inline-flex;
      white-space: nowrap;
      position: relative;
      will-change: transform;
      backface-visibility: hidden;
      transform: translateZ(0);
    }

    .ad-item {
      display: inline-flex;
      align-items: center;
      padding: 1.5rem 4rem;
      /* margin: 0 1.5rem; */
      /* border-radius: 1rem; */
      font-size: 1.5rem;
      font-weight: bold;
      color: white;
      flex-shrink: 0;
      position: relative;
      background: var(--bg-color);
      transition: transform 0.3s ease;
    }

    @media (max-width: 768px) {
      .ad-item {
        padding: 1rem 2rem;
        /* margin: 0 1rem; */
        font-size: 1.2rem;
      }
    }
  </style>
</head>

<body>
  <div class="scroll-container">
    <div class="scroll-track">
      <div class="ad-item" style="--bg-color: #FF6B6B;">ğŸš€ é™æ—¶ç‰¹æƒ </div>
      <div class="ad-item" style="--bg-color: #4ECDC4;">ğŸ æ–°äººç¤¼åŒ…</div>
      <div class="ad-item" style="--bg-color: #45B7D1;">âœˆï¸ å…¨çƒåŒ…é‚®</div>
      <div class="ad-item" style="--bg-color: #96CEB4;">ğŸ’ ä¼šå‘˜ç‰¹æƒ</div>
    </div>
  </div>

  <script>
    class PerfectScroll {
      constructor() {
        this.container = document.querySelector('.scroll-container');
        this.track = document.querySelector('.scroll-track');
        this.items = Array.from(this.track.children);
        this.speed = 0.5; // æ»šåŠ¨é€Ÿåº¦ (px/frame)
        this.rafId = null;
        this.isPaused = false;
        this.cloneThreshold = 2; // æå‰å…‹éš†çš„é˜ˆå€¼

        this.init();
      }

      init() {
        // åˆå§‹åŒ–å…‹éš†
        this.originalWidth = this.track.scrollWidth;
        this.cloneItems();

        // ç»‘å®šäº‹ä»¶
        this.setupEventListeners();
        this.startAnimation();

        // å¼€å¯ä½ç½®ç›‘æ§
        this.monitorPosition();
      }

      cloneItems() {
        // è®¡ç®—éœ€è¦å…‹éš†çš„æ¬¡æ•°
        const visibleItems = Math.ceil(this.container.offsetWidth / this.items[0].offsetWidth);
        const cloneTimes = Math.ceil(visibleItems / this.items.length) + 1;

        // æ‰§è¡Œå…‹éš†
        for (let i = 0; i < cloneTimes; i++) {
          this.items.forEach(item => {
            const clone = item.cloneNode(true);
            this.track.appendChild(clone);
          });
        }
      }

      monitorPosition() {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting &&
              entry.target === this.track.lastElementChild) {
              this.recycleItems();
            }
          });
        }, {
          root: this.container,
          threshold: 0.1
        });

        observer.observe(this.track.lastElementChild);
      }

      recycleItems() {
        // å›æ”¶è¶…å‡ºå¯è§†èŒƒå›´çš„å…ƒç´ 
        const firstItem = this.track.firstElementChild;
        while (this.track.scrollWidth > this.originalWidth * this.cloneThreshold) {
          this.track.removeChild(firstItem);
          this.track.appendChild(firstItem.cloneNode(true));
        }
      }

      animate() {
        if (this.isPaused) return;

        const currentScroll = this.track.style.transform
          ? parseFloat(this.track.style.transform.replace('translateX(', ''))
          : 0;

        let newScroll = currentScroll - this.speed;

        // å¾ªç¯é€»è¾‘
        if (Math.abs(newScroll) >= this.track.scrollWidth / 2) {
          newScroll = 0;
          this.track.style.transform = `translateX(${newScroll}px)`;
        } else {
          this.track.style.transform = `translateX(${newScroll}px)`;
        }

        this.rafId = requestAnimationFrame(() => this.animate());
      }

      setupEventListeners() {
        // æ‚¬åœæ§åˆ¶
        this.container.addEventListener('mouseenter', () => {
          this.isPaused = true;
          cancelAnimationFrame(this.rafId);
        });

        this.container.addEventListener('mouseleave', () => {
          this.isPaused = false;
          this.animate();
        });

        // å“åº”å¼å¤„ç†
        window.addEventListener('resize', () => {
          cancelAnimationFrame(this.rafId);
          this.track.style.transform = 'translateX(0)';
          this.originalWidth = this.track.scrollWidth;
          this.animate();
        });
      }

      startAnimation() {
        this.rafId = requestAnimationFrame(() => this.animate());
      }
    }

    // åˆå§‹åŒ–ç³»ç»Ÿ
    new PerfectScroll();
  </script>
</body>

</html>